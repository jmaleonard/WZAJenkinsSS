(function(e,t,n){var r=function(e){var t,n;t=n=0;if(e.offsetParent){do{t+=e.offsetLeft;n+=e.offsetTop}while((e=e.offsetParent)!==null)}return[t,n]};var i=function(e){this.canvas=e.canvas;this.minRadius=e.minRadius||15;this.arcWidth=e.arcWidth||5;this.gapWidth=e.gapWidth||3;this.centerX=e.centerX||this.canvas.width/2;this.centerY=e.centerY||this.canvas.height/2;this.infoLineLength=e.infoLineLength||60;this.horizLineLength=e.horizLineLength||10;this.infoLineAngleInterval=e.infoLineAngleInterval||Math.PI/8;this.infoLineBaseAngle=e.infoLineBaseAngle||Math.PI/6;this.context=this.canvas.getContext("2d");this.width=this.canvas.width;this.height=this.canvas.height;this.circles=[];this.runningCount=0};i.prototype={constructor:i,addEntry:function(e){this.circles.push(new s({canvas:this.canvas,context:this.context,centerX:this.centerX,centerY:this.centerY,innerRadius:this.minRadius+this.circles.length*(this.gapWidth+this.arcWidth),arcWidth:this.arcWidth,infoLineLength:this.infoLineLength,horizLineLength:this.horizLineLength,id:this.circles.length,fillColor:e.fillColor,outlineColor:e.outlineColor,progressListener:e.progressListener,infoListener:e.infoListener,infoLineAngle:this.infoLineBaseAngle+this.circles.length*this.infoLineAngleInterval}));return this},start:function(e){var t=this;this.timer=setInterval(function(){t._update()},e||33);return this},stop:function(){clearTimeout(this.timer)},_update:function(){this._clear();this.circles.forEach(function(e){e.update()});return this},_clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);return this}};var s=function(e){this.id=e.id;this.canvas=e.canvas;this.context=e.context;this.centerX=e.centerX;this.centerY=e.centerY;this.arcWidth=e.arcWidth;this.innerRadius=e.innerRadius||0;this.fillColor=e.fillColor||"#fff";this.outlineColor=e.outlineColor||this.fillColor;this.progressListener=e.progressListener;this.infoLineLength=e.infoLineLength||250;this.horizLineLength=e.horizLineLength||50;this.infoListener=e.infoListener;this.infoLineAngle=e.infoLineAngle;this.outerRadius=this.innerRadius+this.arcWidth;if(!this.infoListener)return;var n=this.infoLineAngle,i=(this.innerRadius+this.outerRadius)/2,s=Math.sin(n),o=Math.cos(n);this.infoLineStartX=this.centerX+s*i;this.infoLineStartY=this.centerY-o*i;this.infoLineMidX=this.centerX+s*this.infoLineLength;this.infoLineMidY=this.centerY-o*this.infoLineLength;this.infoLineEndX=this.infoLineMidX+(s<0?-this.horizLineLength:this.horizLineLength);this.infoLineEndY=this.infoLineMidY;var u=t.createElement("div"),a=u.style;a.color=this.fillColor;a.position="absolute";a.left=this.infoLineEndX+r(this.canvas)[0]+"px";u.className="ProgressCircleInfo";u.id="progress_circle_info_"+this.id;t.body.appendChild(u);this.infoText=u};s.prototype={constructor:s,update:function(){this.progress=this.progressListener();this._draw();if(this.infoListener){this.info=this.infoListener();this._drawInfo()}},_draw:function(){var e=this.context,t=-Math.PI/2,n=0+t,r=n+this.progress*Math.PI*2,i=this.centerX,s=this.centerY,o=this.innerRadius,u=this.outerRadius;e.fillStyle=this.fillColor;e.strokeStyle=this.outlineColor;e.beginPath();e.arc(i,s,o,n,r,false);e.arc(i,s,u,r,n,true);e.closePath();e.stroke();e.fill();return this},_drawInfo:function(){var e,t;e=[[this.infoLineStartX,this.infoLineStartY],[this.infoLineMidX,this.infoLineMidY],[this.infoLineEndX,this.infoLineEndY]];this._drawSegments(e,false);this.infoText.innerHTML=this.info;t=this.infoText.offsetHeight;this.infoText.style.top=this.infoLineEndY+r(this.canvas)[1]-t/2+"px";return this},_drawSegments:function(e,t){var n=this.context;n.beginPath();n.moveTo(e[0][0],e[0][1]);for(var r=1;r<e.length;++r){n.lineTo(e[r][0],e[r][1])}if(t){n.closePath()}n.stroke()}};e.ProgressCircle=i})(window,document);jQuery(function(e){var t=["#C02942","#4ecdc4","#d95b43","#556270","#542437","#8fbe00"];var n={ERROR:"alert-danger",WARNING:"alert-warning"};var r=function(e){var t=e.split(".");if(t.length<=2){return t.join(".")}else{return t.slice(0,-2).join(".")}};var i=function(e){var t=0,n,r;if(e.length===0)return t;for(n=0,l=e.length;n<l;n++){r=e.charCodeAt(n);t=(t<<5)-t+r;t|=0}return t};var s=function(e){return e.match(/^\/job\/.*?\//)!==null};var o=function(e){return e.match(/^\/job\/.*?\/(.*?=.*?\/)?$/)!==null};var u=function(e){return e.match(/^\/job\/.*?\/$/)!==null};var a=function(e){return e.match(/^\/job\/.*?\//)[0]};var f=function(e){return e.match(/^\/job\/.*?\/(.*?=.*?\/)?/)[0]};var c=function(t,n){e.getJSON(t+"api/json?tree=builds[number]",function(e){for(var r=0;r<e.builds.length;r++){var i=e.builds[r];if(i.number===n){window.location.href=t+n+"/consoleFull"}}setTimeout(function(){c(t,n)},1e3)})};var h=function(t,n){if(u(t)){e.getJSON(t+"api/json?tree=activeConfigurations[name]",function(e){if(JSON.stringify(e)!=="{}"&&"activeConfigurations"in e){var r=t+e.activeConfigurations[0].name+"/";return c(r,n)}else{return c(t,n)}})}else{return c(t,n)}};var p=function(t,n){var r=document.createElement("div");r.className="alert doony-alert "+n;r.innerHTML=t;e("#main-panel").prepend(r)};var d=function(e,t){return"<div class='doony-callout doony-callout-info'><a "+(t===null?"":"href='"+t+"'")+">"+e+"</a></div>"};var v=function(t,n){e.getJSON(t+n+"api/json?tree=lastBuild[number]",function(r){if(r.lastBuild!==null&&"number"in r.lastBuild){e("#matrix .model-link").each(function(i,s){if(s.getAttribute("href")===n){var o=t+n+r.lastBuild.number+"/consoleFull";e(s).next(".doony-callout").children("a").attr("href",o)}})}})};if(e("#matrix").length){setInterval(function(){var t=f(window.location.pathname);if(e("#matrix .doony-downstream-link").length){return}e("#matrix .model-link").wrap("<div class='doony-downstream-link'>");e("#matrix .model-link").each(function(t,n){var r="View console output for the latest build";e(n).after(d(r,null))});e.getJSON(t+"api/json?tree=activeConfigurations[name]",function(e){for(var n=0;n<e.activeConfigurations.length;n++){var r=e.activeConfigurations[n];v(t,r.name+"/")}})},50)}var m=function(t,n){e(t).each(function(){var t=document.createElement("div");t.className="doony-circle doony-circle-"+n;t.style.display="inline-block";var r;if(this.getAttribute("width")==="48"||this.getAttribute("width")==="24"){r=this.getAttribute("width")*.5+8;t.style.marginRight="15px";t.style.verticalAlign="middle"}else if(this.classList.contains("icon32x32")){r=24;t.style.marginTop="4px";t.style.marginLeft="4px"}else{r=this.getAttribute("width")||12}e(t).css("width",r);e(t).css("height",r);e(this).after(t).remove()})};var g=function(t,n){e(t).each(function(){if(e(this).next(".doony-canvas").length){return}var t=document.createElement("canvas");t.className="doony-canvas";var r;if(this.getAttribute("width")==="48"||this.getAttribute("width")==="24"){r=this.getAttribute("width")*.5+8;t.style.marginRight="15px";t.style.verticalAlign="middle"}else if(this.classList.contains("icon32x32")){r=24;t.style.marginTop="4px";t.style.marginLeft="4px"}else{r=this.getAttribute("width")||12}t.setAttribute("width",r);t.setAttribute("height",r);var i=new ProgressCircle({canvas:t,minRadius:r*3/8-2,arcWidth:r/8+1});var s=0;i.addEntry({fillColor:n,progressListener:function(){if(s>=1){s=0}s=s+.005;return s}});i.start(24);e(this).after(t).css("display","none")})};var y="#4f9f4f";setInterval(function(){g("img[src*='red_anime.gif']","#d9534f");g("img[src*='blue_anime.gif']",y);g("img[src*='grey_anime.gif']","#999");g("img[src*='yellow_anime.gif']","#f0ad4e")},10);setInterval(function(){m("img[src*='/grey.png']","aborted");m("img[src*='/blue.png']","success");m("img[src*='/red.png']","failure");m("img[src*='/yellow.png']","warning")},10);if(o(window.location.pathname)){var b=f(window.location.pathname);e.getJSON(b+"api/json?tree=lastBuild[number]",function(t){if(!("lastBuild"in t)||t.lastBuild===null||!("number"in t.lastBuild)){return}var n="View console output for the latest build";var r=b+t.lastBuild.number+"/consoleFull";var i=e("h2:contains('Permalinks')");i.after(d(n,r))})}if(s(window.location.pathname)){var w=document.createElement("button");w.className="btn btn-primary doony-build";w.innerHTML="Build Now";e(w).click(function(){var t=a(window.location.pathname);e.getJSON(t+"api/json?depth=1&tree=nextBuildNumber,lastBuild[building]",function(r){e.post(t+"build",function(){var e="Build #"+r.nextBuildNumber+" created, you will be redirected when it is ready.";if(JSON.stringify(r)!=="{}"&&"lastBuild"in r&&r.lastBuild!==null&&r.lastBuild.building){e+=" <a href='#' id='doony-clear-build'>Cancel the current build</a>"}p(e,n.WARNING);h(f(window.location.pathname),r.nextBuildNumber)}).fail(function(e,t,r){if(e.status===403){p("Cannot create build. Maybe you need to log in or have the 'build' permission.",n.ERROR)}else{p("An error occured. Please try again.",n.ERROR)}})})});e(document).on("click","#doony-clear-build",function(t){t.preventDefault();var n=a(window.location.pathname);e.getJSON(n+"api/json?tree=lastBuild[number]",function(t){e.post(n+t.lastBuild.number+"/stop")})});var E=e("#main-panel h1").first();if(E.children("div").length){E.append(w)}else{E.css("display","inline-block");E.after(w)}}})